---
title: "Integrate Network Station Report"
author: "hydrolook package"
date: "Generated on: `r Sys.Date()` "
output:
  pdf_document:
    toc: true
    fig_caption: yes
  html_document:
    toc: true
    fig_caption: yes
params:
  table_format:
    value: latex
  prov:
    value: PE
  stns:
    value: 08MF005
  start_date: 
    value: !r as.Date("2015-01-01")
  end_date:
    value: !r as.POSIXct("2015-01-01 12:30:00")
header-includes:
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage[table]{xcolor}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
---
---

```{r setup, include=FALSE}
library(hydrolook)
library(tidyhydat)
library(tidyverse)
library(lubridate)



knitr::opts_chunk$set(echo = TRUE, fig.path = "./")
```

## R Markdown


```{r}
params$stns
params$prov
params$start_date
params$end_date
params$table_format
```

```{r}
HIST_FLOW <- DLY_FLOWS(STATION_NUMBER = params$stns)
```

## Last thirty days
```{r}
#HIST_FLOW <- DLY_FLOWS(STATION_NUMBER = params$stns) %>%
#  mutate(Date = ymd(paste0(year(Sys.Date()),month(Date),"-",day(Date)))) %>%
#  filter(Date >= Sys.Date()-30 & Date <= Sys.Date())



#rl_data = download_realtime_dd(STATION_NUMBER = params$STATION_NUMBER, PROV_TERR_STATE_LOC = params$PROV_TERR_STATE_LOC)
rl_data = download_realtime_dd(STATION_NUMBER = params$stns)

rl_data_day <- rl_data %>%
  padr::thicken("day") %>%
  group_by(Date_day, STATION_NUMBER) %>%
  summarise(Value = mean(Value, na.rm = TRUE)) %>%
  filter(Date_day >= (Sys.Date()-30))


HIST_FLOW %>%
  ggplot() +
  geom_histogram(aes(x = Value)) +
  geom_vline(data = rl_data, aes(xintercept = Value, colour = Date)) +
  theme_minimal()

```
